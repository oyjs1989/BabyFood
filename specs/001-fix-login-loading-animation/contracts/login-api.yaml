openapi: 3.0.3
info:
  title: BabyFood Login API
  description: 登录相关 API 接口
  version: 1.0.0
  contact:
    name: BabyFood Team

servers:
  - url: https://api.babyfood.com/v1
    description: Production server
  - url: https://staging-api.babyfood.com/v1
    description: Staging server

tags:
  - name: Authentication
    description: 用户认证相关接口

paths:
  /auth/login:
    post:
      tags:
        - Authentication
      summary: 用户登录
      description: 使用账号（手机号或邮箱）和密码进行登录
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              phone:
                summary: 手机号登录
                value:
                  account: "13800138000"
                  password: "password123"
              email:
                summary: 邮箱登录
                value:
                  account: "user@example.com"
                  password: "password123"
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              example:
                success: true
                token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                user:
                  id: 1
                  account: "13800138000"
                  name: "张三"
                  email: "user@example.com"
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_account:
                  summary: 账号格式错误
                  value:
                    success: false
                    error: "账号格式不正确"
                invalid_password:
                  summary: 密码格式错误
                  value:
                    success: false
                    error: "密码长度至少6位"
        '401':
          description: 账号或密码错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "账号或密码错误"
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "服务器内部错误，请稍后重试"
      security: []

components:
  schemas:
    LoginRequest:
      type: object
      required:
        - account
        - password
      properties:
        account:
          type: string
          description: 账号（手机号或邮箱）
          example: "13800138000"
          pattern: '^(1[3-9]\d{9}|[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})$'
        password:
          type: string
          description: 密码
          format: password
          minLength: 6
          example: "password123"

    LoginResponse:
      type: object
      required:
        - success
        - token
        - user
      properties:
        success:
          type: boolean
          description: 登录是否成功
          example: true
        token:
          type: string
          description: JWT 认证令牌
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        user:
          $ref: '#/components/schemas/User'

    User:
      type: object
      required:
        - id
        - account
        - name
      properties:
        id:
          type: integer
          description: 用户 ID
          example: 1
        account:
          type: string
          description: 账号
          example: "13800138000"
        name:
          type: string
          description: 用户姓名
          example: "张三"
        email:
          type: string
          description: 邮箱地址
          example: "user@example.com"
        phone:
          type: string
          description: 手机号
          example: "13800138000"

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          description: 请求是否成功
          example: false
        error:
          type: string
          description: 错误信息
          example: "账号或密码错误"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT 认证

security:
  - bearerAuth: []