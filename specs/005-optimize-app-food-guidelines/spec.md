# Feature Specification: 优化辅食选择功能 - 基于权威营养指南

**Feature Branch**: `005-optimize-app-food-guidelines`
**Created**: 2026-01-31
**Status**: Draft
**Input**: User description: "根据 @food.md 优化一下当前app"

## Clarifications

### Session 2026-01-31

- Q: 营养成分数据的来源和更新频率如何确定？是否需要实时更新还是定期更新？ → A: 每季度更新一次，使用权威营养数据库（如中国食物成分表），平衡准确性和维护成本
- Q: 如果用户忽略系统的安全警告，是否需要记录并在后续提醒？ → A: 记录并在后续遇到类似风险时加强提醒，但仍允许用户选择
- Q: 营养数据来源的显示方式如何确定？ → A: 在食谱详情页底部显示简洁的来源标注（如"数据来源：中国食物成分表"）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 智能食材推荐与铁优先提醒 (Priority: P1)

**用户旅程**：当用户为宝宝创建或查看辅食计划时，系统自动根据权威营养指南（WHO、中国营养学会等）的六大原则（铁优先、安全第一、质地适配、原味多样化、新鲜度、自制与市售互补）推荐合适的食材和食谱，并突出显示富铁食物，帮助用户科学选择辅食。

**为什么这个优先级**：铁是辅食的第一刚性需求，缺铁会导致不可逆的认知发育损伤。这是所有辅食选择的基础，直接影响宝宝健康，因此是最高优先级。

**独立测试**：可以通过查看宝宝的今日餐单或创建新计划来测试，系统应自动推荐富含铁的食谱（如强化铁米粉、红肉泥、动物肝脏），并在界面上明确标识这些食谱的"富铁"属性。即使用户只使用这一个功能，也能获得核心的营养保障价值。

**接受场景**：

1. **Given** 用户有一个6月龄的宝宝，**When** 用户查看今日餐单或创建新计划，**Then** 系统优先推荐富铁食谱（如强化铁米粉、红肉泥），并在食谱卡片上显示"富铁推荐"标识
2. **Given** 用户的宝宝已添加过敏食材（如鸡蛋），**When** 系统推荐食谱时，**Then** 自动过滤掉含有过敏食材的食谱，但仍优先推荐其他富铁食物
3. **Given** 用户查看食谱详情，**When** 食谱包含富铁食材（红肉、动物肝脏、强化铁米粉），**Then** 显示铁含量信息和"铁优先"营养提示
4. **Given** 用户的宝宝月龄在6-9个月，**When** 系统推荐食谱时，**Then** 优先推荐符合国标铁含量要求（≥6mg/100g）的市售辅食和自制富铁食谱

---

### User Story 2 - 质地适配性引导 (Priority: P2)

**用户旅程**：根据宝宝的咀嚼能力发育阶段，系统自动推荐适合质地的食谱，并提供质地过渡指南，帮助用户循序渐进地锻炼宝宝的咀嚼能力。

**为什么这个优先级**：质地适配直接影响宝宝的口腔发育和语言能力，延迟引入块状食物会导致咀嚼能力发育迟缓。虽然不如铁补充紧急，但对长期发育至关重要。

**独立测试**：可以通过查看宝宝的月龄和食谱推荐来测试，系统应根据月龄自动筛选适合质地的食谱（6-8月龄推荐泥糊状，9-11月龄推荐稠泥/末状，12月龄以上推荐软固体/块状）。即使用户只使用这个功能，也能获得科学的质地过渡指导。

**接受场景**：

1. **Given** 用户的宝宝6-8个月，**When** 系统推荐食谱，**Then** 只推荐质地为"泥糊状"的食谱（如南瓜米糊、胡萝卜土豆泥）
2. **Given** 用户的宝宝9-11个月，**When** 系统推荐食谱，**Then** 推荐质地为"稠泥/末状"的食谱（如鸡肉粥、牛肉土豆泥），并在食谱详情显示"适合牙床压碎"提示
3. **Given** 用户的宝宝12个月以上，**When** 系统推荐食谱，**Then** 推荐质地为"软固体/块状"的食谱（如蔬菜肉丸、小馄饨），并提示"可咀嚼软固体"
4. **Given** 用户查看食谱详情，**When** 食谱质地不符合宝宝当前月龄，**Then** 显示警告："此食谱质地可能不适合当前月龄，建议选择更细软的食谱"
5. **Given** 用户的宝宝咀嚼能力发育较快，**When** 用户在宝宝档案中备注"咀嚼能力较强"，**Then** 系统可以适当推荐更粗质地食谱，但仍保持安全边界

---

### User Story 3 - 安全风险预警与禁忌食材管理 (Priority: P2)

**用户旅程**：系统自动识别并预警辅食中的安全风险，包括绝对禁用食材（1岁内蜂蜜、高汞鱼类）、需特殊处理食材（发芽土豆、未煮熟四季豆）、高硝酸盐食材（菠菜、芹菜），并在用户选择或查看这些食材时提供明确的安全提示和处理建议。

**为什么这个优先级**：安全性是辅食选择的刚性底线，直接关系到宝宝健康。虽然风险事件发生率较低，但一旦发生后果严重，因此是高优先级功能。

**独立测试**：可以通过添加包含风险食材的食谱或查看食谱详情来测试，系统应在相关食谱上显示安全警告，并提供正确的处理方法。即使用户只使用这个功能，也能获得关键的安全保障。

**接受场景**：

1. **Given** 用户的宝宝不满1岁，**When** 系统检测到食谱含有蜂蜜或高汞鱼类，**Then** 在食谱卡片上显示红色警告标识"1岁内禁用"，并点击后显示原因和替代建议
2. **Given** 用户的宝宝不满1岁，**When** 系统检测到食谱含有白糖或普通酱油，**Then** 在食谱卡片上显示黄色警告标识"1岁内不推荐"，并解释对肾脏和味觉发育的影响
3. **Given** 用户查看食谱详情，**When** 食谱含有需特殊处理的食材（如四季豆、鲜黄花菜），**Then** 显示处理建议："需冷水下锅煮15分钟以上"或"需焯水后煮熟"
4. **Given** 用户查看食谱详情，**When** 食谱含有高硝酸盐蔬菜（菠菜、芹菜），**Then** 显示处理建议："建议焯水后食用，避免亚硝酸盐危害"
5. **Given** 用户的宝宝已添加过敏食材，**When** 系统推荐食谱时，**Then** 自动过滤含有该过敏食材的食谱，并在推荐结果中提示"已过滤X个含过敏食材的食谱"

---

### User Story 4 - 原味多样化引导与挑食预防 (Priority: P3)

**用户旅程**：系统引导用户遵循"原味优先"原则，1岁内不加调味品，并鼓励逐步引入多样化天然口味，帮助预防挑食。系统记录宝宝尝试过的食材，并在推荐时优先推荐新食材，促进味觉发育。

**为什么这个优先级**：口味引导影响宝宝长期的饮食习惯和健康，但不会立即造成健康风险，因此优先级低于安全和营养保障。不过对长期用户价值非常重要。

**独立测试**：可以通过查看宝宝的食材记录和食谱推荐来测试，系统应统计宝宝已尝试的食材数量，并在推荐时优先推荐新食材。即使用户只使用这个功能，也能获得口味多样化指导。

**接受场景**：

1. **Given** 用户的宝宝不满1岁，**When** 用户查看食谱详情，**Then** 显示"原味推荐"标识，提示"1岁内不加盐糖"
2. **Given** 用户的宝宝不满1岁，**When** 系统检测到食谱含有蜂蜜、白糖、普通酱油，**Then** 在食谱详情显示"1岁内禁用调味品"警告
3. **Given** 用户的宝宝已尝试过5种食材，**When** 系统推荐食谱，**Then** 优先推荐包含新食材的食谱，并在推荐结果中标注"新食材：胡萝卜"
4. **Given** 用户的宝宝10-12个月，**When** 系统分析宝宝的食材记录，**Then** 如果每日食材种类少于4种，显示提示"建议增加食材种类，促进味觉发育"
5. **Given** 用户的宝宝1岁以上，**When** 系统推荐食谱，**Then** 可以推荐淡口味食谱（如添加少量番茄、香菇提鲜），并提示"逐步引入淡口味"

---

### User Story 5 - 新鲜度与制作方式建议 (Priority: P3)

**用户旅程**：系统根据食材类型和月龄，提供新鲜度建议（优先新鲜食材，科学利用冷冻/罐装产品），并指导用户在自制与市售辅食之间做出科学选择，平衡营养、安全与便捷性。

**为什么这个优先级**：新鲜度和制作方式影响营养保留和安全性，但对大多数家庭来说，合理选择也能达到良好效果，因此优先级较低。不过对提升用户体验和科学性有帮助。

**独立测试**：可以通过查看食谱详情或食材建议来测试，系统应提供新鲜度提示和制作方式建议。即使用户只使用这个功能，也能获得实用的食材选择指导。

**接受场景**：

1. **Given** 用户查看食谱详情，**When** 食谱主要食材为绿叶蔬菜（如菠菜），**Then** 显示新鲜度建议："建议当天食用，冷藏不超过1-3天"
2. **Given** 用户查看食谱详情，**When** 食谱主要食材为根茎类蔬菜（如胡萝卜），**Then** 显示新鲜度建议："可冷藏1-3天，冷冻可保留更多营养"
3. **Given** 用户的宝宝6-9个月，**When** 系统推荐米糊类食谱，**Then** 优先推荐市售强化铁米粉，并提示"市售强化铁米粉铁含量更高，符合国标要求"
4. **Given** 用户的宝宝10个月以上，**When** 系统推荐食谱，**Then** 可以推荐自制辅食，增加食材多样性，并提示"自制辅食需确保卫生安全"
5. **Given** 用户查看食谱详情，**When** 食谱需长时间存放（如自制湿米粉），**Then** 显示安全警告："需现做现吃，存放超24小时会产生致病菌"

---

### User Story 6 - 营养目标与食谱匹配度分析 (Priority: P2)

**用户旅程**：系统根据权威营养指南的核心营养素需求（铁、锌、维生素A、钙、维生素D、维生素C），分析宝宝当前饮食的营养摄入情况，并与推荐食谱的营养成分进行匹配，帮助用户确保营养均衡。

**为什么这个优先级**：营养均衡是辅食的核心目标之一，但比铁补充和安全性稍弱。不过对宝宝的全面发育非常重要，因此设为中等优先级。

**独立测试**：可以通过查看宝宝的营养目标和今日餐单的营养汇总来测试，系统应显示各营养素的摄入情况和达标率。即使用户只使用这个功能，也能获得营养均衡指导。

**接受场景**：

1. **Given** 用户查看今日餐单，**When** 系统分析今日食谱的营养成分，**Then** 显示各营养素的摄入量（铁、锌、维生素A、钙、维生素C），并与推荐目标对比
2. **Given** 用户的宝宝今日铁摄入不足，**When** 用户查看营养汇总，**Then** 显示"铁摄入不足"警告，并推荐富铁食谱
3. **Given** 用户的宝宝今日维生素C摄入充足，**When** 用户查看营养汇总，**Then** 显示"维生素C充足，有助于铁吸收"提示
4. **Given** 用户查看食谱详情，**When** 食谱富含某种营养素（如维生素C），**Then** 显示营养亮点："富含维生素C，促进铁吸收"
5. **Given** 用户的宝宝1岁以上，**When** 系统推荐食谱，**Then** 确保荤素比例约为1:2，避免长期单一食材

---

### Edge Cases

- **当宝宝同时存在多种过敏食材时**：系统应过滤掉所有含过敏食材的食谱，如果过滤后没有可用食谱，显示提示"暂无符合条件的食谱，请联系营养师定制"
- **当宝宝月龄在边界值（如5个月或9个月）时**：系统应根据实际发育情况推荐食谱，并提供灵活调整选项，允许用户根据宝宝的咀嚼能力选择更细或更粗的质地
- **当用户尝试添加禁忌食材到食谱时**：系统应阻止操作并显示警告，但允许用户选择"忽略警告继续"（需二次确认）。系统将记录用户的忽略行为，并在后续遇到类似风险时加强提醒，但仍允许用户选择
- **当宝宝的食材记录较少时**：系统应优先推荐常见、安全的食材，并提示"建议逐步增加食材种类，促进味觉发育"
- **当网络不可用时**：系统应仍能提供基础的功能（查看已保存的食谱、查看营养目标），但云端AI推荐功能不可用，显示"离线模式，部分功能受限"
- **当宝宝营养目标数据缺失时**：系统应根据月龄自动生成默认的营养目标（基于中国营养学会标准），并提示"营养目标已根据月龄自动设置，可在宝宝档案中调整"
- **当食谱营养成分数据不完整时**：系统应标记该食谱，并显示"营养成分数据不完整"提示，但不影响食谱推荐

## Requirements *(mandatory)*

### Functional Requirements

#### 铁优先与营养推荐

- **FR-001**: 系统必须根据宝宝月龄优先推荐富铁食谱（6-9月龄推荐强化铁米粉、红肉泥、动物肝脏；10月龄以上推荐多样化富铁食物）
- **FR-002**: 系统必须在食谱卡片上明确标识"富铁推荐"属性，并提供铁含量信息（如有数据）
- **FR-003**: 系统必须在食谱详情页显示核心营养素含量（铁、锌、维生素A、钙、维生素C），并与推荐目标对比
- **FR-004**: 系统必须在营养汇总页面显示各营养素的摄入量和达标率，用颜色标识（绿色：达标，黄色：接近达标，红色：不足）
- **FR-005**: 系统必须在营养不足时提供具体的食谱推荐（如"铁摄入不足，推荐：鸡肉粥、牛肉土豆泥"）

#### 质地适配性

- **FR-006**: 系统必须根据宝宝月龄自动筛选食谱质地（6-8月龄：泥糊状；9-11月龄：稠泥/末状；12月龄以上：软固体/块状）
- **FR-007**: 系统必须在食谱详情页显示质地信息和适用月龄（如"质地：泥糊状，适合6-8个月"）
- **FR-008**: 系统必须在食谱质地不符合宝宝当前月龄时显示警告，并提供替代建议
- **FR-009**: 系统必须允许用户在宝宝档案中备注"咀嚼能力较强"或"咀嚼能力较弱"，系统据此调整食谱推荐

#### 安全风险预警

- **FR-010**: 系统必须识别绝对禁用食材（1岁内：蜂蜜、高汞鱼类），并在食谱卡片上显示红色警告标识"1岁内禁用"
- **FR-011**: 系统必须识别不推荐食材（1岁内：白糖、普通酱油），并在食谱卡片上显示黄色警告标识"1岁内不推荐"
- **FR-012**: 系统必须在食谱详情页显示风险原因和处理建议（如"蜂蜜含肉毒杆菌芽孢，1岁内禁用"）
- **FR-013**: 系统必须识别需特殊处理的食材（四季豆、鲜黄花菜、发芽土豆），并在食谱详情页显示处理建议
- **FR-014**: 系统必须识别高硝酸盐食材（菠菜、芹菜），并在食谱详情页显示"建议焯水后食用"提示
- **FR-015**: 系统必须根据宝宝过敏食材自动过滤食谱，并在推荐结果中提示"已过滤X个含过敏食材的食谱"

#### 原味多样化引导

- **FR-016**: 系统必须在1岁内食谱详情页显示"原味推荐"标识，提示"1岁内不加盐糖"
- **FR-017**: 系统必须记录宝宝已尝试过的食材，并在推荐时优先推荐新食材
- **FR-018**: 系统必须在推荐食谱时标注新食材（如"新食材：胡萝卜"）
- **FR-019**: 系统必须在宝宝食材种类少于推荐值时（10-12月龄<4种）显示提示"建议增加食材种类，促进味觉发育"
- **FR-020**: 系统必须在1岁以上食谱中推荐淡口味食谱（添加番茄、香菇等天然提鲜食材）

#### 新鲜度与制作方式

- **FR-021**: 系统必须在食谱详情页显示新鲜度建议（如绿叶蔬菜"建议当天食用"，根茎类"可冷藏1-3天"）
- **FR-022**: 系统必须在6-9月龄推荐米糊时优先推荐市售强化铁米粉，并提示"市售强化铁米粉铁含量更高"
- **FR-023**: 系统必须在10月龄以上推荐食谱时可以推荐自制辅食，并提示"自制辅食需确保卫生安全"
- **FR-024**: 系统必须在需长时间存放的食谱上显示安全警告（如"需现做现吃，存放超24小时会产生致病菌"）

#### 数据管理与用户设置

- **FR-025**: 系统必须允许用户在宝宝档案中查看和编辑营养目标（铁、锌、维生素A、钙、维生素C）
- **FR-026**: 系统必须根据月龄自动生成默认营养目标（基于中国营养学会标准）
- **FR-027**: 系统必须记录宝宝已尝试过的食材列表，允许用户查看和编辑
- **FR-028**: 系统必须允许用户在宝宝档案中备注咀嚼能力情况
- **FR-029**: 系统必须在食谱详情页底部显示营养成分数据来源的简洁标注（如"数据来源：中国食物成分表"）

#### 辅助功能

- **FR-030**: 系统必须提供食材搜索功能，支持按营养素筛选（如"富含铁的食材"）
- **FR-031**: 系统必须提供营养知识科普页面，解释六大辅食选择原则（铁优先、安全第一、质地适配、原味多样化、新鲜度、自制与市售互补）
- **FR-032**: 系统必须在网络不可用时提供离线模式，允许查看已保存的食谱和营养目标

### Key Entities

- **宝宝档案（BabyProfile）**：包含宝宝的基本信息、月龄、过敏食材、偏好食材、营养目标、咀嚼能力备注、已尝试食材列表
- **食谱（Recipe）**：包含食谱名称、食材列表、营养成分（铁、锌、维生素A、钙、维生素C）、质地类型、适用月龄、制作方式、安全风险标识
- **食材（Ingredient）**：包含食材名称、营养成分、安全风险等级（禁用/不推荐/需特殊处理/正常）、新鲜度建议
- **营养目标（NutritionGoal）**：包含铁、锌、维生素A、钙、维生素C的每日推荐摄入量
- **营养摄入记录（NutritionIntake）**：记录宝宝每日各营养素的实际摄入量，与目标对比
- **食材尝试记录（IngredientTrial）**：记录宝宝尝试过的食材、尝试日期、是否过敏
- **安全风险（SafetyRisk）**：包含风险类型（禁用/不推荐/需特殊处理）、风险描述、处理建议、适用月龄

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户能够在3分钟内为宝宝创建符合营养指南的辅食计划，系统自动推荐富铁食谱并标识
- **SC-002**: 系统推荐的食谱中，符合宝宝月龄质地要求的比例达到95%以上
- **SC-003**: 用户查看食谱详情时，安全风险标识的准确率达到100%（所有禁用食材都被正确识别和警告）
- **SC-004**: 用户的宝宝营养达标率（铁、锌、维生素A、钙、维生素C）提升40%（通过用户问卷调查和营养摄入记录统计）
- **SC-005**: 90%的用户表示系统推荐的食谱更科学、更符合营养指南（通过用户满意度调查）
- **SC-006**: 系统能够处理1000个并发用户的食谱推荐请求，响应时间不超过2秒
- **SC-007**: 用户在添加新食材到食谱时，系统识别安全风险的准确率达到100%
- **SC-008**: 用户的宝宝食材种类多样性（每月尝试的新食材数量）提升30%（通过用户数据统计）
- **SC-009**: 95%的用户能够在使用系统后正确识别和规避辅食安全风险（通过用户知识测试）
- **SC-010**: 系统的营养数据准确率达到95%（与权威营养数据库对比）

## Assumptions

- **假设1**：用户已了解宝宝的基本信息（月龄、过敏食材、咀嚼能力），并能够在系统中正确录入
- **假设2**：食谱的营养成分数据可以从权威营养数据库获取（如中国食物成分表）
- **假设3**：用户遵循系统的安全提示，不会故意给宝宝食用禁用食材
- **假设4**：系统能够根据宝宝月龄自动生成合理的营养目标，用户可以在此基础上微调
- **假设5**：用户具备基本的烹饪能力，能够按照食谱的指导制作辅食
- **假设6**：食材的新鲜度建议基于通用标准，用户可以根据实际情况灵活调整
- **假设7**：系统的AI推荐功能依赖网络连接，离线模式下只能提供基础功能
- **假设8**：用户的宝宝营养目标数据基于中国营养学会标准，不同地区可能有细微差异

## Dependencies

- **依赖1**：权威营养数据库（如中国食物成分表）的API接口，用于获取食材和食谱的营养成分数据。数据更新频率为每季度一次，平衡准确性和维护成本
- **依赖2**：宝宝档案数据必须完整（月龄、过敏食材、偏好食材），否则系统无法提供准确的推荐
- **依赖3**：食谱数据库必须包含足够的食谱（覆盖不同月龄、不同质地、不同营养需求），否则推荐结果可能不理想
- **依赖4**：网络连接必须稳定，否则AI推荐功能无法使用
- **依赖5**：用户必须定期更新宝宝的营养摄入记录，否则系统无法准确分析营养达标率

## Out of Scope

- **以下内容不在本功能范围内**：
  - 食谱图片拍摄和上传功能
  - 食谱视频教程制作功能
  - 用户社区和食谱分享功能
  - 商业化功能（如付费食谱、专家咨询）
  - 自动化采购清单生成功能
  - 库存管理和食材过期提醒功能
  - 多语言支持（仅支持中文）
  - 营养师在线咨询功能
  - 宝宝生长发育曲线分析（已有独立功能）
  - 体检记录和健康分析（已有独立功能）

## Open Questions

- **问题1**：营养成分数据的来源和更新频率如何确定？是否需要实时更新还是定期更新？
  - **影响**：影响营养推荐的准确性和系统维护成本
  - **建议**：使用权威营养数据库（如中国食物成分表），每季度更新一次数据

- **问题2**：用户如何验证系统的营养推荐是否准确？是否需要提供营养数据来源的引用？
  - **影响**：影响用户对系统的信任度
  - **建议**：在营养推荐页面显示数据来源（如"数据来源：中国营养学会《0~2岁婴幼儿喂养指南》"）

- **问题3**：如果用户忽略系统的安全警告，是否需要记录并在后续提醒？
  - **影响**：影响宝宝安全和用户体验
  - **建议**：记录用户忽略的警告，下次遇到类似风险时加强提醒，但仍允许用户选择